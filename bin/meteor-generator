#!/usr/bin/env node

var type = process.argv[2];
var name = process.argv[3];

if(!(type && name)) {
  console.log('You need to provice a [type] and a [name]');
  process.exit(1);
}

var mkdirp = require('mkdirp');
var fs     = require('fs');
var _      = require('lodash');

var path     = './client/' + type + 's' + '/' + name;
var segments = name.split('/').filter(Boolean);

var destinationFile = path + '/' + _.last(segments);
var templateName    = segments.map(function(segment){
  return segment.split(/[-_]/).map(_.capitalize).join('');
}).join('');

// create path
mkdirp.sync(path);

// create html file
generateFile(type, 'html', templateName);

// create js file
generateFile(type, 'js', templateName);

console.log('SUCCESS');

function generateFile(type, fileExt, templateName){
  if(type === 'component') {
     type = 'route';
  }
  var blueprint = __dirname + '/../blueprints/' + type + '/blueprint';
  var content = fs.readFileSync(blueprint + '.' + fileExt, 'utf8');
  content = content.replace(/\_\_NAME\_\_/g, templateName);

  var destinationFileName = destinationFile + '.' + fileExt;
  fs.writeFileSync(destinationFileName , content);
};
